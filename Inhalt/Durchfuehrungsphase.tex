% !TEX root = ../Projektdokumentation.tex
\section{Durchführungsphase}
\label{sec:Durchführungsphase}

\subsection{Vorbereitung der Tests}
\label{sec:VorbereitungTests}

\subsubsection{Vorbereiten der Hardware}
\label{sec:VorbereitungHardware}
Eine ausrangierte DELL Precision Workstation dient als Hardwareplattform für das Projekt. Die Ausstattung von 32 Gigabyte Arbeitsspeicher und einem Intel Xeon Hochleistungsprozessor ist ausreichend für den Betrieb von mehreren virtuellen Maschinen.

Um den Bedingungen in einem \glqq{}echtem\grqq{} Rechencenter möglichst nahe zu kommen, wird der VM-Hypervisor mit zwei Netzwerkschnittstellen ausgestattet. Ein Interface ist für die Kommunikation mit dem Hypervisor selbst vorgesehen (sogenanntes Management-LAN), und eine weitere Netzwerkschnittstelle wird von den virtuellen Maschinen benutzt, um im Netzwerk erreichbar zu sein.

Da die vorgesehene Workstation mit nur einem RJ45 Port ausgestattet war, wurde aus einer anderen die zusätzliche Netzwerkkarte entfernt und in diese eingebaut. Der Umbau gestaltete sich dank PCIe-Steckplatz als unkompliziert und war ohne Werkzeuggebrauch möglich.

\subsubsection{Installation des Hypervisors}
\label{sec:InstallationHypervisor}
Um die gegeben Ressourcen optimal auszunutzen, wird ein sogenannter Typ 1-Hypervisor eingesetzt. Dieser kommuniziert direkt mit der Hardware, ohne dass ein anderes Betriebssystem zum Einsatz kommt. Der Markt an VM-Hypervisoren ist stark umkämpft; neben den bekannten Lösungen von den \glqq{}Platzhirschen\grqq{} Microsoft, VMware und Citrix existiert eine Vielzahl an kleinen, teils auch quelloffenen, Virtualisierungsplattformen. Für dieses Projekt wird das System \glqq{}ESXi\grqq{} von VMware in der Version 6.7 verwendet, das auch in den firmeneigenen Rechenzentren zum Einsatz kommt.

Die Installation gestaltet sich als simpel. Nachdem wichtige UEFI-Optionen angepasst wurden (ausschließliche Verwendung von UEFI statt legacy-BIOS; Aktivierung der hardewareseitigen Unterstützung für Virtualisierung \glqq{}Intel VT-x\grqq{}) wird das System von einem USB-Datenträger, der zuvor mit dem ESXi-Image geflasht wurde, gestartet. Nachdem die für die Installation zu benutzende Festplatte ausgewählt, und ein Root-Passwort vergeben wurde, startet der Installationsvorgang. Nach abgeschlossener Installation muss noch eine IP-Adresse für das Managementnetzwerk vergeben werden.

Die restliche Konfiguration geschieht bequem über eine Weboberfläche. Der Lizenzschlüssel wird hinterlegt, die zweite Festplatte als Datastore eingebunden, und das Netzwerk für die virtuellen Maschinen konfiguriert (siehe Abbildung \ref{screen:vmnetwork}). Hierzu wird ein neuer virtueller Switch für den zweiten Netzwerkport (der, der nicht mit dem Management-LAN belegt ist) erstellt und mit einer neuen Port Group versehen. Diese Port Groups werden in ESXi verwendet, um logische Netzwerkschnittstellen bereit zu stellen und zu verwalten. 

\subsubsection{Installation der virtuellen Maschinen}
\label{sec:InstallationVMs}
Für virtuelle Maschinen muss in der ESXi-Weboberfläche zunächst die Systemkonfiguration festgelegt werden. Hierfür werden die für die VM vorgesehene CPU-Kerne, Arbeits- und Massenspeicherspeicherkapazität (siehe Abbildung \ref{screen:vmcreation}) sowie die zu benutzenden Port Groups eingestellt. Abschließend wird in ein virtuelles DVD-Laufwerk das ISO-Abbild für das entsprechende zu installierende Betriebssystem eingehängt, und die virtuelle Maschine gestartet. Die anschließende Betriebssysteminstallation kann über eine emulierte Browser-Konsole durchgeführt werden.

Um in diesem Testsystem eine möglichst nah an das Firmennetzwerk heranzukommen, wurden drei Betriebssysteme für die Server ausgewählt: Windows Server 2019, Ubuntu 18.04 LTS sowie Debian 10.3. Die Installation der Systeme verlief ohne Probleme.

\subsubsection{Installation von \glqq{}Icinga\grqq{}}
\label{sec:InstallationIcinga}
Die Installation von \glqq{}Icinga\grqq{} unter Ubuntu beginnt mit dem Aufruf der Rootshell und einem anschließendem kompletten Systemupdate. Danach werden mittels Paketverwaltung die wichtigsten Ressourcen installiert; die Pakete \code{icinga2} und \code{icingacli} sind für die Monitoring-Engine an sich sowie die Verwaltung über Kommandozeile zuständig. \code{monitoring-plugins} installiert die grundsätzlichen Monitoringmethoden (z.B. Ping) für Nagios-kompatible Systeme wie \glqq{}Icinga\grqq{}.

Zusätzlich muss noch eine passende Datenbank aufgesetzt werden, hier fiel die Entscheidung aufgrund der firmeninteren Verbreitung sowie der In-Memory Unterstützung auf MySQL. Durch Installation der Pakete \code{mysql-server} und \code{mysql-client} werden ein MySQL-Server und ein MySQL-Client bereitgestellt, das Skript \code{mysql\_secure\_installation} (siehe Abbildung \ref{screen:mysqlsecure}) verbessert die Sicherheit der Installation durch Maßnahmen wie das Entfernen von anonymen Accounts oder die Absicherung des root-Accounts.

Im nächsten Schritt muss die Schnittstelle zwischen \glqq{}Icinga Data Output\grqq{} (Exportfunktion für Monitoringdaten) und MySQL geschaffen werden, damit die gesammelten Daten auch gespeichert werden können. Dies geschieht durch Installation des Pakets \code{icinga2-ido-mysql}. Anschließend kann das Webinterface \code{icingaweb2} installiert werden.

Beim Versuch, die über die Paketverwaltung verfügbare Version des Web-Frontends aufzurufen, wird lediglich ein PHP-Fehler (siehe Abbildung \ref{screen:phperror}) angezeigt. Nach einer umfangreichen Recherche ergab sich, dass dieser Fehler durch einen Bug verursacht wird, wodurch \glqq{}Icinga\grqq{} nicht mit bestimmten PHP 7.2 Plugins kompatibel ist. Dieser Fehler wurde bereits Mitte 2018 behoben, allerdings ist der Bugfix anscheinend nicht in das Paket eingespielt worden. Das Problem wurde gelöst, indem die aktuelle Version von \glqq{}Icinga Web 2\grqq{} vom öffentlichen Github-Repository nach \code{/usr/share/icingaweb2} geklont wurde.

Ist \glqq{}Icinga Web 2\grqq{} fertig installiert, muss noch ein Benutzer für die MySQL-Datenbank erstellt werden. Abschließend wird IDO mittels \code{icinga2 feature enable command ido-mysql} aktiviert, und ein Setup-Token mit \code{icingacli setup token create} generiert werden. Nach einem Neustart des icinga2-Dienstes (\code{systemctl restart icinga2}) ist \glqq{}Icinga 2\grqq{} bereit über die Webschnittstelle eingerichtet zu werden. Eine komplette (nachträglich optimierte) Liste an Befehlen, die für eine komplette Installation unter Ubuntu 18.04 ausgeführt werden müssen, findet sich unter \ref{app:skript} \nameref{app:skript}.

\paragraph{Einrichtung über Webfrontend}
Im Browser wird nun (IP-Adresse des Servers)/icingaweb2/setup aufgerufen, um den Konfigurationsassistenten (siehe Abbildung \ref{screen:konfigassistent}) zu starten. Dieser verlangt nach dem setup token, welcher im vorherigen Schritt generiert wurde. Nach Eingabe dieses tokens wird im ersten Schritt geprüft, ob alle notwendigen PHP-Plugins vorhanden sind. In der für diese Projekt durchgeführten Installation fehlten die Plugins \glqq{}PDO-PostgreSQL\grqq{}, welches aufgrund der Verwendung von MySQL nicht benötigt wird, sowie \glqq{}cURL\grqq{}, das mittels \code{apt install php7.2-curl} nachinstalliert wurde.

Im Abschnitt \glqq{}Configuration\grqq{} werden weitere Einstellungen getroffen, hierbei bietet sich aber meistens an, die Standardeinstellungen beizubehalten. Eine Ausnahme stellt die bevorzugte Authentifizierungsmethode für Benutzer des Frontends dar; hier kann zwischen LDAP und einer Datenbank mit Benutzern gewählt werden. Für dieses Projekt wurde aufgrund des geringeren Umfangs letztere Option gewählt, die Konfiguration hierfür findet sich in Abbildung \ref{screen:userdb}.

\paragraph{Einpflegen von Servern}
\label{sec:EinpflegenServer}

\subsection{Durchführung der Tests}
\label{sec:DurchführungTests}



\subsubsection{Betriebssystemkompatibilität}
\label{sec:EinpflegenServer}

\subsubsection{Überwachung von Leistungsparametern}
\label{sec:ÜberwachungLeistungsparameter}

\subsubsection{Webserverüberwachung}
\label{sec:ÜberwachungWebserver}

\subsubsection{Grafische Aufbereitung}
\label{sec:GrafischeAufbereitung}